const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/Login-nOq5nvwA.js","assets/vendor-IDWrQIHz.js","assets/state-MjgzQ4RD.js","assets/Signup-vSEIHXbj.js","assets/VerifyOtp-CEcFeo9N.js","assets/ForgotPassword-Cp3qriyq.js","assets/ResetPassword-s5lpq7RG.js","assets/AccountLocked-VgsU8Ctk.js","assets/EmailNotVerified-BTneU_Wu.js","assets/Dashboard-CWGFan_r.js","assets/appStore-BPO_w7dw.js","assets/Tasks-VXGMnghu.js","assets/Habits-B5OZf5oj.js","assets/Deadlines-DoySyENh.js","assets/Onboarding-Bmt148kI.js","assets/Settings-kfVpQvCf.js"])))=>i.map(i=>d[i]);
import{r as c,a as $,u as C,N as E,O as U,b as f,B as F,c as B,d,R as q}from"./vendor-IDWrQIHz.js";import{a as L,c as H}from"./state-MjgzQ4RD.js";(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))s(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const i of a.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&s(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(r){if(r.ep)return;r.ep=!0;const a=n(r);fetch(r.href,a)}})();var T={exports:{}},_={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var Q=c,W=Symbol.for("react.element"),J=Symbol.for("react.fragment"),K=Object.prototype.hasOwnProperty,Y=Q.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,G={key:!0,ref:!0,__self:!0,__source:!0};function A(e,o,n){var s,r={},a=null,i=null;n!==void 0&&(a=""+n),o.key!==void 0&&(a=""+o.key),o.ref!==void 0&&(i=o.ref);for(s in o)K.call(o,s)&&!G.hasOwnProperty(s)&&(r[s]=o[s]);if(e&&e.defaultProps)for(s in o=e.defaultProps,o)r[s]===void 0&&(r[s]=o[s]);return{$$typeof:W,type:e,key:a,ref:i,props:r,_owner:Y.current}}_.Fragment=J;_.jsx=A;_.jsxs=A;T.exports=_;var t=T.exports,b={},P=$;b.createRoot=P.createRoot,b.hydrateRoot=P.hydrateRoot;const M="modulepreload",X=function(e){return"/"+e},N={},p=function(o,n,s){let r=Promise.resolve();if(n&&n.length>0){document.getElementsByTagName("link");const i=document.querySelector("meta[property=csp-nonce]"),l=(i==null?void 0:i.nonce)||(i==null?void 0:i.getAttribute("nonce"));r=Promise.allSettled(n.map(h=>{if(h=X(h),h in N)return;N[h]=!0;const x=h.endsWith(".css"),D=x?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${D}`))return;const m=document.createElement("link");if(m.rel=x?"stylesheet":M,x||(m.as="script"),m.crossOrigin="",m.href=h,l&&m.setAttribute("nonce",l),document.head.appendChild(m),x)return new Promise((z,V)=>{m.addEventListener("load",z),m.addEventListener("error",()=>V(new Error(`Unable to preload CSS for ${h}`)))})}))}function a(i){const l=new Event("vite:preloadError",{cancelable:!0});if(l.payload=i,window.dispatchEvent(l),!l.defaultPrevented)throw i}return r.then(i=>{for(const l of i||[])l.status==="rejected"&&a(l.reason);return o().catch(a)})},I="http://localhost:8080";let y=null;function j(e){y=e}function w(){y=null}const u=L.create({baseURL:`${I}/api/v1`,headers:{"Content-Type":"application/json"},withCredentials:!0});u.interceptors.request.use(e=>(y&&(e.headers.Authorization=`Bearer ${y}`),e));let v=!1,k=[];function S(e,o){k.forEach(n=>{e?n.reject(e):o&&n.resolve(o)}),k=[]}u.interceptors.response.use(e=>e,async e=>{var n,s;const o=e.config;if(((n=e.response)==null?void 0:n.status)===401&&!o._retry&&!((s=o.url)!=null&&s.includes("/auth/"))){if(v)return new Promise((r,a)=>{k.push({resolve:i=>{o.headers.Authorization=`Bearer ${i}`,r(u(o))},reject:a})});o._retry=!0,v=!0;try{const{data:r}=await L.post(`${I}/api/v1/auth/refresh`,{},{withCredentials:!0}),a=r.data.accessToken;return j(a),S(null,a),o.headers.Authorization=`Bearer ${a}`,u(o)}catch(r){return S(r,null),w(),window.location.href="/login",Promise.reject(r)}finally{v=!1}}return Promise.reject(e)});const R=H((e,o)=>({user:null,profile:null,loading:!1,error:null,initialized:!1,authStep:"idle",pendingEmail:null,maskedEmail:null,otpExpiresIn:300,resetToken:null,login:async(n,s)=>{e({loading:!0,error:null});try{const r=await u.post("/auth/login",{email:n,password:s}),{user:a,tokens:i}=r.data.data;if(j(i.accessToken),a.lockedUntil&&new Date(a.lockedUntil)>new Date){e({loading:!1,authStep:"account-locked",user:a});return}if(!a.verified){e({loading:!1,authStep:"email-not-verified",pendingEmail:n,user:a});return}e({user:a,profile:a,loading:!1,authStep:"idle"})}catch(r){const a=g(r,"Login failed");throw a.toLowerCase().includes("locked")?e({error:a,loading:!1,authStep:"account-locked"}):e({error:a,loading:!1}),r}},signup:async(n,s,r)=>{e({loading:!0,error:null});try{const a=await u.post("/auth/signup",{email:n,password:s,displayName:r}),{maskedEmail:i,expiresInSeconds:l}=a.data.data;e({loading:!1,authStep:"otp-verify",pendingEmail:n,maskedEmail:i,otpExpiresIn:l})}catch(a){const i=g(a,"Signup failed");throw e({error:i,loading:!1}),a}},verifyOtp:async(n,s)=>{e({loading:!0,error:null});try{const r=await u.post("/auth/verify-otp",{email:n,otp:s}),{user:a,tokens:i}=r.data.data;j(i.accessToken),e({user:a,profile:a,loading:!1,authStep:"idle",pendingEmail:null,maskedEmail:null})}catch(r){const a=g(r,"Verification failed");throw e({error:a,loading:!1}),r}},resendOtp:async n=>{e({loading:!0,error:null});try{const s=await u.post("/auth/resend-otp",{email:n}),{maskedEmail:r,expiresInSeconds:a}=s.data.data;e({loading:!1,maskedEmail:r,otpExpiresIn:a})}catch(s){const r=g(s,"Failed to resend OTP");throw e({error:r,loading:!1}),s}},forgotPassword:async n=>{e({loading:!0,error:null});try{const s=await u.post("/auth/forgot-password",{email:n}),{maskedEmail:r,expiresInSeconds:a}=s.data.data;e({loading:!1,authStep:"forgot-otp",pendingEmail:n,maskedEmail:r,otpExpiresIn:a})}catch(s){const r=g(s,"Request failed");throw e({error:r,loading:!1}),s}},verifyResetOtp:async(n,s)=>{e({loading:!0,error:null});try{const r=await u.post("/auth/verify-reset-otp",{email:n,otp:s});e({loading:!1,authStep:"reset-password",resetToken:r.data.data.resetToken})}catch(r){const a=g(r,"Verification failed");throw e({error:a,loading:!1}),r}},resetPassword:async n=>{e({loading:!0,error:null});const{resetToken:s,pendingEmail:r}=o();try{await u.post("/auth/reset-password",{email:r,resetToken:s,newPassword:n}),e({loading:!1,authStep:"idle",resetToken:null,pendingEmail:null,maskedEmail:null})}catch(a){const i=g(a,"Reset failed");throw e({error:i,loading:!1}),a}},logout:async()=>{try{await u.post("/auth/logout")}catch{}w(),e({user:null,profile:null,authStep:"idle",pendingEmail:null,maskedEmail:null,resetToken:null})},clearError:()=>e({error:null}),setAuthStep:n=>e({authStep:n}),initAuth:()=>((async()=>{try{const s=await u.post("/auth/refresh",{}),{user:r,tokens:a}=s.data.data;j(a.accessToken),e({user:r,profile:r,initialized:!0})}catch{w(),e({initialized:!0})}})(),()=>{}),fetchProfile:async()=>{try{const n=await u.get("/users/me");e({profile:n.data.data})}catch(n){throw console.error("Failed to fetch profile",n),n}},completeOnboarding:async n=>{e({loading:!0});try{const s=await u.post("/users/onboarding",{bio:n});e({profile:s.data.data,loading:!1})}catch(s){throw e({loading:!1}),s}}}));function g(e,o){var n,s;return e&&typeof e=="object"&&"response"in e?((s=(n=e.response)==null?void 0:n.data)==null?void 0:s.message)||o:e instanceof Error?e.message:o}function Z(){var a,i;const{user:e,logout:o}=R(),n=C(),s=async()=>{await o(),n("/login")},r=[{to:"/",icon:"ðŸ“Š",label:"Dashboard"},{to:"/tasks",icon:"âœ…",label:"Tasks"},{to:"/habits",icon:"ðŸ”¥",label:"Habits"},{to:"/deadlines",icon:"â°",label:"Deadlines"},{to:"/settings",icon:"âš™ï¸",label:"Settings"}];return t.jsxs(t.Fragment,{children:[t.jsxs("aside",{className:"sidebar",children:[t.jsxs("div",{className:"sidebar-logo",children:[t.jsx("div",{className:"logo-icon",children:"âš¡"}),t.jsx("h1",{children:"Productiv"})]}),t.jsx("nav",{className:"sidebar-nav",children:r.map(l=>t.jsxs(E,{to:l.to,className:({isActive:h})=>`sidebar-link ${h?"active":""}`,end:l.to==="/",children:[t.jsx("span",{className:"link-icon",children:l.icon}),t.jsx("span",{children:l.label})]},l.to))}),t.jsxs("div",{className:"sidebar-footer",children:[t.jsxs("div",{className:"sidebar-user",children:[t.jsx("div",{className:"user-avatar",children:((a=e==null?void 0:e.displayName)==null?void 0:a.charAt(0).toUpperCase())||((i=e==null?void 0:e.email)==null?void 0:i.charAt(0).toUpperCase())||"U"}),t.jsxs("div",{className:"user-info",children:[t.jsx("div",{className:"user-name",children:(e==null?void 0:e.displayName)||"User"}),t.jsx("div",{className:"user-email",children:e==null?void 0:e.email})]})]}),t.jsxs("button",{className:"sidebar-link",onClick:s,style:{marginTop:"8px"},children:[t.jsx("span",{className:"link-icon",children:"ðŸšª"}),t.jsx("span",{children:"Logout"})]})]})]}),t.jsxs("nav",{className:"bottom-bar",children:[r.slice(0,4).map(l=>t.jsxs(E,{to:l.to,className:({isActive:h})=>`bottom-bar-link ${h?"active":""}`,end:l.to==="/",children:[t.jsx("span",{className:"link-icon",children:l.icon}),t.jsx("span",{children:l.label})]},l.to)),t.jsxs(E,{to:"/settings",className:({isActive:l})=>`bottom-bar-link ${l?"active":""}`,children:[t.jsx("span",{className:"link-icon",children:"âš™ï¸"}),t.jsx("span",{children:"Settings"})]})]})]})}function ee(){return t.jsxs("div",{className:"app-layout",children:[t.jsx(Z,{}),t.jsx("main",{className:"main-content",children:t.jsx(U,{})})]})}function te({children:e}){const{user:o,initialized:n,loading:s}=R();return!n||s?t.jsx("div",{className:"loader",children:t.jsx("div",{className:"spinner"})}):o?t.jsx(t.Fragment,{children:e}):t.jsx(f,{to:"/login",replace:!0})}class re extends c.Component{constructor(o){super(o),this.state={hasError:!1,error:null}}static getDerivedStateFromError(o){return{hasError:!0,error:o}}render(){var o;return this.state.hasError?t.jsxs("div",{className:"empty-state",children:[t.jsx("div",{className:"empty-icon",children:"âš ï¸"}),t.jsx("h3",{children:"Something went wrong"}),t.jsx("p",{children:(o=this.state.error)==null?void 0:o.message}),t.jsx("button",{className:"btn btn-primary",onClick:()=>window.location.reload(),children:"Reload Page"})]}):this.props.children}}const se=c.lazy(()=>p(()=>import("./Login-nOq5nvwA.js"),__vite__mapDeps([0,1,2])).then(e=>({default:e.Login}))),ae=c.lazy(()=>p(()=>import("./Signup-vSEIHXbj.js"),__vite__mapDeps([3,1,2])).then(e=>({default:e.Signup}))),ne=c.lazy(()=>p(()=>import("./VerifyOtp-CEcFeo9N.js"),__vite__mapDeps([4,1,2])).then(e=>({default:e.VerifyOtp}))),oe=c.lazy(()=>p(()=>import("./ForgotPassword-Cp3qriyq.js"),__vite__mapDeps([5,1,2])).then(e=>({default:e.ForgotPassword}))),ie=c.lazy(()=>p(()=>import("./ResetPassword-s5lpq7RG.js"),__vite__mapDeps([6,1,2])).then(e=>({default:e.ResetPassword}))),le=c.lazy(()=>p(()=>import("./AccountLocked-VgsU8Ctk.js"),__vite__mapDeps([7,1,2])).then(e=>({default:e.AccountLocked}))),ce=c.lazy(()=>p(()=>import("./EmailNotVerified-BTneU_Wu.js"),__vite__mapDeps([8,1,2])).then(e=>({default:e.EmailNotVerified}))),de=c.lazy(()=>p(()=>import("./Dashboard-CWGFan_r.js"),__vite__mapDeps([9,1,10,2])).then(e=>({default:e.Dashboard}))),ue=c.lazy(()=>p(()=>import("./Tasks-VXGMnghu.js"),__vite__mapDeps([11,1,10,2])).then(e=>({default:e.Tasks}))),pe=c.lazy(()=>p(()=>import("./Habits-B5OZf5oj.js"),__vite__mapDeps([12,1,10,2])).then(e=>({default:e.Habits}))),he=c.lazy(()=>p(()=>import("./Deadlines-DoySyENh.js"),__vite__mapDeps([13,1,10,2])).then(e=>({default:e.Deadlines}))),fe=c.lazy(()=>p(()=>import("./Onboarding-Bmt148kI.js"),__vite__mapDeps([14,1,2])).then(e=>({default:e.Onboarding}))),me=c.lazy(()=>p(()=>import("./Settings-kfVpQvCf.js"),__vite__mapDeps([15,1,2])).then(e=>({default:e.Settings})));function O(){return t.jsx("div",{className:"loader",style:{minHeight:"100vh"},children:t.jsx("div",{className:"spinner"})})}function ge(){const{initAuth:e,initialized:o,user:n,profile:s}=R();return c.useEffect(()=>{const r=e();return()=>r()},[e]),o?t.jsx(re,{children:t.jsx(F,{children:t.jsx(c.Suspense,{fallback:t.jsx(O,{}),children:t.jsxs(B,{children:[t.jsx(d,{path:"/login",element:n?t.jsx(f,{to:"/",replace:!0}):t.jsx(se,{})}),t.jsx(d,{path:"/signup",element:n?t.jsx(f,{to:"/",replace:!0}):t.jsx(ae,{})}),t.jsx(d,{path:"/verify-otp",element:t.jsx(ne,{})}),t.jsx(d,{path:"/forgot-password",element:t.jsx(oe,{})}),t.jsx(d,{path:"/reset-password",element:t.jsx(ie,{})}),t.jsx(d,{path:"/account-locked",element:t.jsx(le,{})}),t.jsx(d,{path:"/email-not-verified",element:t.jsx(ce,{})}),t.jsxs(d,{element:t.jsx(te,{children:t.jsx(ee,{})}),children:[t.jsx(d,{index:!0,element:s&&!s.onboarded?t.jsx(f,{to:"/onboarding",replace:!0}):t.jsx(de,{})}),t.jsx(d,{path:"tasks",element:s&&!s.onboarded?t.jsx(f,{to:"/onboarding",replace:!0}):t.jsx(ue,{})}),t.jsx(d,{path:"habits",element:s&&!s.onboarded?t.jsx(f,{to:"/onboarding",replace:!0}):t.jsx(pe,{})}),t.jsx(d,{path:"deadlines",element:s&&!s.onboarded?t.jsx(f,{to:"/onboarding",replace:!0}):t.jsx(he,{})}),t.jsx(d,{path:"settings",element:s&&!s.onboarded?t.jsx(f,{to:"/onboarding",replace:!0}):t.jsx(me,{})}),t.jsx(d,{path:"onboarding",element:s!=null&&s.onboarded?t.jsx(f,{to:"/",replace:!0}):t.jsx(fe,{})})]}),t.jsx(d,{path:"*",element:t.jsx(f,{to:"/",replace:!0})})]})})})}):t.jsx(O,{})}b.createRoot(document.getElementById("root")).render(t.jsx(q.StrictMode,{children:t.jsx(ge,{})}));export{u as c,t as j,R as u};
