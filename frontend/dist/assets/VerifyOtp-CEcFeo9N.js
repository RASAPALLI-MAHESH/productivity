import{u as j,j as s}from"./index-CvPcnR5S.js";import{r as i,u as T,L}from"./vendor-IDWrQIHz.js";import"./state-MjgzQ4RD.js";const c=6,b=30;function z(){const[a,h]=i.useState(Array(c).fill("")),[l,g]=i.useState(b),o=i.useRef([]),{verifyOtp:D,resendOtp:E,loading:m,error:y,clearError:v,pendingEmail:r,maskedEmail:N,authStep:d}=j(),u=T();i.useEffect(()=>{!r&&d!=="otp-verify"&&d!=="forgot-otp"&&u("/signup")},[r,d,u]),i.useEffect(()=>{if(l<=0)return;const e=setInterval(()=>g(t=>t-1),1e3);return()=>clearInterval(e)},[l]),i.useEffect(()=>{var e;(e=o.current[0])==null||e.focus()},[]);const w=(e,t)=>{var p;if(!/^\d*$/.test(t))return;const n=[...a];n[e]=t.slice(-1),h(n),t&&e<c-1&&((p=o.current[e+1])==null||p.focus())},S=(e,t)=>{var n;t.key==="Backspace"&&!a[e]&&e>0&&((n=o.current[e-1])==null||n.focus())},k=e=>{var x;e.preventDefault();const t=e.clipboardData.getData("text").replace(/\D/g,"").slice(0,c);if(!t)return;const n=[...a];for(let f=0;f<t.length;f++)n[f]=t[f];h(n);const p=Math.min(t.length,c-1);(x=o.current[p])==null||x.focus()},O=async e=>{e.preventDefault(),v();const t=a.join("");if(!(t.length!==c||!r))try{if(d==="forgot-otp"){const{verifyResetOtp:n}=j.getState();await n(r,t),u("/reset-password")}else await D(r,t),u("/")}catch{}},C=async()=>{var e;if(!(l>0||!r)){v();try{await E(r),g(b),h(Array(c).fill("")),(e=o.current[0])==null||e.focus()}catch{}}},R=a.every(e=>e!=="");return s.jsx("div",{className:"auth-container",children:s.jsxs("div",{className:"auth-card",style:{maxWidth:440,textAlign:"center"},children:[s.jsx("div",{style:{fontSize:"3.5rem",marginBottom:"var(--space-4)"},children:"ðŸ”"}),s.jsx("h1",{children:"Check your email"}),s.jsxs("p",{children:["We sent a 6-digit code to"," ",s.jsx("strong",{style:{color:"var(--text-primary)"},children:N||r})]}),y&&s.jsx("div",{className:"auth-error",children:y}),s.jsxs("form",{onSubmit:O,style:{marginTop:"var(--space-6)"},children:[s.jsx("div",{className:"otp-container",children:a.map((e,t)=>s.jsx("input",{ref:n=>{o.current[t]=n},type:"text",inputMode:"numeric",maxLength:1,className:`otp-input ${e?"filled":""}`,value:e,onChange:n=>w(t,n.target.value),onKeyDown:n=>S(t,n),onPaste:t===0?k:void 0,autoComplete:"one-time-code"},t))}),s.jsx("button",{type:"submit",className:"btn btn-primary btn-lg",disabled:m||!R,style:{marginTop:"var(--space-6)",width:"100%"},children:m?"Verifying...":"Verify Email"})]}),s.jsxs("div",{style:{marginTop:"var(--space-6)",fontSize:"var(--font-size-sm)",color:"var(--text-muted)"},children:["Didn't receive the code?"," ",l>0?s.jsxs("span",{children:["Resend in ",s.jsxs("strong",{style:{color:"var(--text-secondary)"},children:[l,"s"]})]}):s.jsx("button",{onClick:C,className:"auth-link",disabled:m,style:{background:"none",border:"none",cursor:"pointer",padding:0},children:"Resend OTP"})]}),s.jsxs("div",{className:"auth-footer",children:["Wrong email? ",s.jsx(L,{to:"/signup",children:"Go back"})]})]})})}export{z as VerifyOtp};
